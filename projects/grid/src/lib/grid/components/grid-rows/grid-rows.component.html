<cdk-virtual-scroll-viewport
  [itemSize]="table.rowHeightInPx"
  class="grid-viewport"
  [style.width.px]="tableWidthInPx$ | async"
>
  <div
    cdkDropList
    (cdkDropListDropped)="onDropRow($event)"
    class="grid-body"
    #body>
    <pr-grid-column-group-row
      [columnGroups]="table.columnGroups"
      [gridTemplateColumns]="gridTemplate$ | async"
    ></pr-grid-column-group-row>
    <pr-grid-header-row
      [columns]="columns"
      [gridTemplateColumns]="gridTemplate$ | async"
    ></pr-grid-header-row>
    <pr-grid-row
      *cdkVirtualFor="let row of table.rows; let i = index; trackBy: trackByRow"
      cdkDrag
      [cdkDragData]="row"
      [row]="row"
      [columns]="columns"
      [columnToCellMapper]="table.columnToCellMapper"
      [gridTemplateColumns]="gridTemplate$ | async"
      (click)="onClickRow(row, i)"
      (dblclick)="onDoubleClickRow(row)"
    >
      <ng-template cdkDragPreview>
        <pr-grid-row
          [row]="row"
          [columns]="[columns[0]]"
          [columnToCellMapper]="table.columnToCellMapper"
          [gridTemplateColumns]="gridTemplate$ | async"
        ></pr-grid-row>
      </ng-template>
    </pr-grid-row>
  </div>
  <div
    *ngFor="let selectedRow of tableStore.selectedRows$ | async"
    class="grid-row-selection"
    [style.height.px]="table.rowHeightInPx"
    [style.top.px]="64 + (selectedRow.index - virtualViewport.getRenderedRange().start) * (table.rowHeightInPx + 2)">
  </div>
</cdk-virtual-scroll-viewport>
