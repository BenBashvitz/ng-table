<div
  cdkDropListGroup
  class="grid-table"
>
  <div
    class="grid-header"
    [style.grid-template-columns]="gridTemplate"
    [style.grid-auto-rows.px]="30"
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDropGroup($event)"
    (scroll)="onScroll($event)"
    #scroll
  >
    <div
      *ngFor="let group of columnGroups; trackBy: trackByColumn"
      cdkDrag
      cdkDragLockAxis="x"
      cdkDragPreviewContainer="parent"
      [cdkDragData]="group"
      (cdkDragStarted)="onDragStart()"
      (cdkDragEnded)="onDragEnd()"
      [tvsColumnResize]="group"
      class="cell group drag"
      [class.sticky]="group.isSticky"
      [style.left.px]="group.isSticky ? getGroupStickyLeft(group) : null"
      [style.grid-column]="groupToColumnAmountMap[group.columnDef]"
    >
      {{ group.title }}
      <span class="resizer"></span>
      <ng-template cdkDragPreview>

      </ng-template>
    </div>
  </div>
  <div
    class="grid-header"
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDropColumn($event)"
    [style.grid-template-columns]="gridTemplate"
    [style.grid-auto-rows.px]="18"
    #scroll
  >
    <div
      *ngFor="let column of tableColumns; let i = index trackBy: trackByColumn"
      cdkDrag
      cdkDragLockAxis="x"
      cdkDragPreviewContainer="parent"
      [cdkDragDisabled]="column.isSticky"
      [cdkDragData]="column"
      [tvsColumnResize]="column"
      (cdkDragStarted)="onDragStart()"
      (cdkDragEnded)="onDragEnd()"
      [class.sticky]="column.isSticky"
      [style.left.px]="column.isSticky ? getStickyLeft(i) : null"
      class="cell header drag"
    >
      {{ column.title }}
      <span class="resizer"></span>
      <ng-template cdkDragPreview>

      </ng-template>
    </div>
  </div>

  <cdk-virtual-scroll-viewport
    [itemSize]="table.rowHeightInPx ?? defaults.rowHeightInPx"
    class="grid-viewport"
    (scroll)="onScroll($event)"
    #scroll
  >
    <div
      cdkDropList
      (cdkDropListDropped)="onDropRow($event)"
      class="grid-body"
    >
      <div
        class="grid-row"
        *cdkVirtualFor="let row of table.rows; trackBy: trackByRow"
        [style.grid-template-columns]="gridTemplate"
        [style.grid-auto-rows.px]="36"
        cdkDrag
        [cdkDragData]="row"
        (click)="onClickRow($event, row)"
      >
        <div
          *ngFor="let column of tableColumns; let i = index"
          class="cell"
          [ngClass]="column.columnDef"
          [class.sticky]="column.isSticky"
          [style.left.px]="column.isSticky ? getStickyLeft(i) : null"
        >
          <ng-container *ngIf="table | tableCell: column: row">
            <ng-container *ngIf="isNormalCell(table | tableCell: column: row)">
              {{ ((table | tableCell: column: row) | toNormalCell).cellText }}
            </ng-container>
            <ng-container *ngIf="isCustomCell(table | tableCell: column: row)">
              <ng-container
                *ngComponentOutlet="((table | tableCell: column: row) | toComponentCell).component;"></ng-container>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="!(table | tableCell: column: row)">
            row does not have a cell for this column
          </ng-container>
        </div>
      </div>
    </div>
  </cdk-virtual-scroll-viewport>
</div>
