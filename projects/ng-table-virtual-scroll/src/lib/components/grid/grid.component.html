<div
  cdkDropListGroup
  class="grid-table"
>
  <div
    class="grid-header groups"
    [style.grid-template-columns]="gridGroupTemplate"
    [style.grid-auto-rows.px]="30"
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDropGroup($event)"
    (scroll)="onScroll($event)"
    #scroll
  >
    <div
      *ngFor="let group of columnGroups; trackBy: trackByColumn"
      cdkDrag
      cdkDragLockAxis="x"
      cdkDragPreviewContainer="parent"
      [cdkDragData]="group"
      (cdkDragStarted)="onDragStart()"
      (cdkDragEnded)="onDragEnd()"
      [tvsColumnResize]="group"
      class="cell group drag"
      [class.sticky]="group.isSticky"
      [style.left.px]="group.isSticky ? getGroupStickyLeft(group) : null"
      [style.grid-column]="groupToColumnAmountMap[group.columnDef]"
    >
      {{ group.title }}
      <span class="resizer"></span>
      <ng-template cdkDragPreview>

      </ng-template>
    </div>
  </div>
  <div
    class="grid-header columns"
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDropColumn($event)"
    [style.grid-template-columns]="gridGroupTemplate"
    [style.grid-auto-rows.px]="18"
    #scroll
  >
    <div
      *ngFor="let group of columnGroups; trackBy: trackByColumn"
      class="column-group"
      [style.grid-column]="groupToColumnAmountMap[group.columnDef]"
    >

      <div
        *ngFor="let column of group.columns; let i = index trackBy: trackByColumn"
        cdkDrag
        cdkDragLockAxis="x"
        cdkDragPreviewContainer="parent"
        [cdkDragDisabled]="column.isSticky"
        [cdkDragData]="column"
        [tvsColumnResize]="column"
        (cdkDragStarted)="onDragStart()"
        (cdkDragEnded)="onDragEnd()"
        [class.sticky]="column.isSticky"
        [style.left.px]="column.isSticky ? getStickyLeft(i) : null"
        class="cell header drag"
      >
        {{ column.title }}
        <span class="resizer"></span>
        <ng-template cdkDragPreview>

        </ng-template>
      </div>
    </div>
  </div>

  <cdk-virtual-scroll-viewport
    [itemSize]="table.rowHeightInPx ?? defaults.rowHeightInPx"
    class="grid-viewport"
    (scroll)="onScroll($event)"
    #scroll
  >
    <div
      cdkDropList
      (cdkDropListDropped)="onDropRow($event)"
      class="grid-body"
      #body
    >
      <div
        class="grid-row"
        *cdkVirtualFor="let row of table.rows; trackBy: trackByRow"
        [style.grid-template-columns]="gridGroupTemplate"
        [style.grid-auto-rows.px]="36"
        cdkDrag
        [cdkDragData]="row"
        (click)="onClickRow($event, row)"
        (dblclick)="onDoubleClickRow(row)"
      >
        <div
          *ngFor="let group of columnGroups; trackBy: trackByColumn"
          class="cell-group"
          [style.grid-column]="groupToColumnAmountMap[group.columnDef]"
        >
          <div
            *ngFor="let column of group.columns; let i = index"
            class="cell"
            [ngClass]="column.columnDef"
            [class.sticky]="column.isSticky"
            [style.left.px]="column.isSticky ? getStickyLeft(i) : null"
          >
            <ng-container *ngIf="table | tableCell: column: row">
              <ng-container *ngIf="isNormalCell(table | tableCell: column: row)">
                {{ ((table | tableCell: column: row) | toNormalCell).cellText }}
              </ng-container>
              <ng-container *ngIf="isCustomCell(table | tableCell: column: row)">
                <ng-container
                  *ngComponentOutlet="((table | tableCell: column: row) | toComponentCell).component;"></ng-container>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="!(table | tableCell: column: row)">
              row does not have a cell for this column
            </ng-container>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngFor="let rowId of table.selectedRowsIds;"
      class="row-selection-outline"
      [style.height.px]="table.rowHeightInPx ?? defaults.rowHeightInPx"
      [style.width]="'100%'"
      [style.top.px]="(((table.rowHeightInPx ?? defaults.rowHeightInPx) + 2) * getRowIndex(rowId))"
    >
    </div>
  </cdk-virtual-scroll-viewport>
</div>
